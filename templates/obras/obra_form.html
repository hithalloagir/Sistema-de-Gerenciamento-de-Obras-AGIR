{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}
  {% if object %}
    Editar Obra: {{ object.nome }}
  {% else %}
    Cadastrar Nova Obra
  {% endif %}
{% endblock %}

{% block content %}
  <h1 class="mb-4">
    {% if object %}Editar Obra{% else %}Cadastrar Nova Obra{% endif %}
  </h1>

  <div class="card">
    <div class="card-body">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <h5 class="mb-3">Dados da Obra</h5>
        {{ form|crispy }}
        {% if can_duplicate_last_obra and last_obra_for_duplicate %}
        <div class="alert alert-info small">
          <strong>Duplicar ultima obra:</strong> ao marcar a opcao acima usaremos "{{ last_obra_for_duplicate.nome }}" como modelo. Apenas categorias e tarefas serao copiadas; inspecoes, pendencias, anexos e datas da obra nao sao reaproveitados. O nome sera ajustado automaticamente e o status ficara como Ativa.
        </div>
        {% elif creator_user_level == 'nivel2' %}
        <div class="alert alert-warning small">
          Usuarios nivel 2 precisam selecionar a opcao de duplicar ultima obra para concluir o cadastro.
        </div>
        {% endif %}

        {% if not object %}
          <hr class="my-4">
          <h5 class="mb-3">Adicionar Categorias Iniciais (Opcional)</h5>
          {{ categorias_formset.management_form }}
          {% for form in categorias_formset %}
            <div class="row">{{ form|crispy }}</div>
          {% endfor %}
        {% endif %}

        <button type="submit" class="btn btn-primary mt-3">Salvar</button>
        <a href="{% if object %}{% url 'obras:detalhe_obra' object.id %}{% else %}{% url 'obras:listar_obras' %}{% endif %}" class="btn btn-secondary mt-3">Cancelar</a>
      </form>
    </div>
  </div>
{% endblock %}
