{% extends "base.html" %}
{% block title %}Inspeção {{ inspecao.id }}{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'obras:listar_obras' %}">Obras</a></li>
    <li class="breadcrumb-item"><a href="{% url 'obras:detalhe_obra' inspecao.obra.id %}">{{ inspecao.obra.nome }}</a></li>
    <li class="breadcrumb-item active" aria-current="page">Inspeção #{{ inspecao.id }}</li>
  </ol>
</nav>

<div class="card mb-4">
  <div class="card-body">
    <h1 class="h4 mb-3">Inspeção #{{ inspecao.id }}</h1>
    <div class="row g-3">
      <div class="col-md-6">
        <p><strong>Data:</strong> {{ inspecao.data_inspecao|date:"d/m/Y" }}</p>
        <p><strong>Registrada em:</strong> {{ inspecao.data_hora|date:"d/m/Y H:i" }}</p>
        <p><strong>Usuário:</strong> {{ inspecao.usuario.username }}</p>
      </div>
      <div class="col-md-6">
        <p><strong>Categoria:</strong> {{ inspecao.categoria|default_if_none:"—" }}</p>
        <p><strong>Tarefa:</strong> {{ inspecao.tarefa|default_if_none:"—" }}</p>
        <p><strong>Coordenadas:</strong>
          {% if inspecao.latitude and inspecao.longitude %}
            {{ inspecao.latitude }}, {{ inspecao.longitude }}
          {% else %}
            —
          {% endif %}
        </p>
      </div>
    </div>
    <div class="mt-3">
      <p><strong>Observações:</strong></p>
      <p class="mb-0">{{ inspecao.observacoes_gerais|default:"Sem observações." }}</p>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Itens de inspeção</span>
  </div>
  <div class="card-body">
    {% if inspecao.itens.all %}
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle mb-0">
          <thead>
            <tr>
              <th>Ponto</th>
              <th>Status</th>
              <th>Observação</th>
            </tr>
          </thead>
          <tbody>
            {% for item in inspecao.itens.all %}
              <tr>
                <td>{{ item.ponto }}</td>
                <td>{{ item.get_status_display }}</td>
                <td>{{ item.observacao|default:"—" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="mb-0 text-muted">Nenhum item registrado nesta inspeção.</p>
    {% endif %}
  </div>
</div>

<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Fotos da inspeção</span>
  </div>
  <div class="card-body">
    {% if inspecao.fotos.all %}
      <div class="row g-3">
        {% for foto in inspecao.fotos.all %}
          <div class="col-md-4">
            <div class="card h-100">
              <img src="{{ foto.imagem.url }}" class="card-img-top" alt="Foto inspeção {{ forloop.counter }}">
              {% if foto.legenda %}
              <div class="card-body">
                <p class="card-text">{{ foto.legenda }}</p>
              </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="mb-0 text-muted">Nenhuma foto anexada a esta inspeção.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
